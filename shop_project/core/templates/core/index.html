<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–æ–π –ú–∞–≥–∞–∑–∏–Ω</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; }
        .product-card { border: none; border-radius: 15px; transition: 0.3s; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .navbar { background: linear-gradient(90deg, #2c3e50, #000000); }
        .review-box { background: #f8f9fa; border-radius: 8px; padding: 10px; margin-top: 10px; font-size: 0.9rem; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark mb-4">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">üöÄ TECH SHOP</a>
        <div class="d-flex">
            <a href="/admin/" class="btn btn-outline-light btn-sm">–ê–¥–º–∏–Ω–∫–∞</a>
        </div>
    </div>
</nav>

<div class="container">
    <h2 class="mb-4">–ù–∞—à–∏ —Ç–æ–≤–∞—Ä—ã</h2>
    <div class="row" id="product-list">
        <div class="text-center">
            <div class="spinner-border text-primary" role="status"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
            <a href="/reviews-list/" class="btn btn-outline-warning ms-2">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –æ—Ç–∑—ã–≤—ã</a>
        </div>
    </div>
</div>

<script>
    async function loadProducts() {
        const container = document.getElementById('product-list');
        try {
            const response = await fetch('/api/shop/products/');
            if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');

            const products = await response.json();
            container.innerHTML = ''; // –£–±–∏—Ä–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä

            if (products.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info text-center">
                        <h5>–¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç!</h5>
                        <p>–ó–∞–π–¥–∏—Ç–µ –≤ <a href="/api/shop/products/">API</a> –∏–ª–∏ <a href="/admin/">–∞–¥–º–∏–Ω–∫—É</a> –∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä.</p>
                    </div>`;
                return;
            }

            products.forEach(p => {
                let reviewsHtml = '';
                if (p.reviews && p.reviews.length > 0) {
                    p.reviews.forEach(r => {
                        reviewsHtml += `
                            <div class="review-box">
                                <strong>‚≠ê ${r.rating}</strong>: ${r.text}
                            </div>`;
                    });
                }

                container.innerHTML += `
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 product-card shadow-sm">
                            <div class="card-body">
                                <span class="badge bg-secondary mb-2">ID: ${p.id}</span>
                                <h4 class="card-title">${p.name}</h4>
                                <h5 class="text-success fw-bold">${p.price} ‚Ç∏</h5>
                                <p class="text-muted small">${p.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</p>
                                ${reviewsHtml}
                                <button class="btn btn-primary w-100 mt-3 shadow-sm">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                            </div>
                        </div>
                    </div>`;
            });
        } catch (error) {
            container.innerHTML = `<div class="alert alert-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
        }
    }

    loadProducts();
</script>
</body>
</html>